import pandas as pd
from dateutil import tz

def mask_session(ts_series: pd.Series, tz_name: str, start: str, end: str):
    """מסנן את הדאטה לפי שעות הסשן"""
    local = ts_series.dt.tz_convert(tz_name)
    s = local.dt.strftime("%H:%M")
    
    # טיפול במקרה שהסשן עובר חצות
    if start <= end:
        return (s >= start) & (s <= end)
    else:
        # למשל אסיה: 23:00 עד 07:00
        return (s >= start) | (s <= end)

# שעות הסשנים בשעון ישראל (שים לב שזה משתנה בין קיץ לחורף!)
# כרגע מוגדר לשעון קיץ
SESSIONS = {
    "NY": ("16:30", "23:00"),      # 9:30-16:00 בניו יורק = 16:30-23:00 בישראל (קיץ)
    "London": ("10:00", "18:30"),   # 8:00-16:30 בלונדון = 10:00-18:30 בישראל
    "Asia": ("02:00", "09:00"),     # שווקי אסיה - טוקיו, הונג קונג, סינגפור
    "Sydney": ("00:00", "07:00"),   # שוק אוסטרליה
    
    # סשנים מותאמים אישית לקריפטו (24/7 אבל עם נפח גבוה בשעות מסוימות)
    "Crypto_Peak": ("14:00", "02:00"),  # שעות שיא במסחר קריפטו
    "Crypto_Asia": ("02:00", "10:00"),  # שעות אסיה בקריפטו
    "Crypto_US": ("16:00", "00:00"),    # שעות ארה"ב בקריפטו
}